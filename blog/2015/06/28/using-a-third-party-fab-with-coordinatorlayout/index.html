<!doctype html><html lang=en-us><head><link href=https://gmpg.org/xfn/11 rel=profile><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta http-equiv=cache-control content="public"><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><meta http-equiv=content-security-policy content="frame-src https://www.youtube.com/embed/;"><meta name=generator content="Hugo 0.72.0"><title>Using a Third Party FAB with CoordinatorLayout • Andy Dyer</title><meta name=twitter:card content="summary"><meta name=twitter:title content="Using a Third Party FAB with CoordinatorLayout"><meta name=twitter:description content="Before the Design Support Library was announced at Google I/O last month, I had numerous third party libraries in my projects for various elements of Material Design. I&rsquo;ve enjoyed replacing the nav drawer, tabs, and parallax scrolling libraries with their support library counterparts. However, on one of my projects, we needed an expanding floating action button (FAB) similar to the one in Inbox, which the support library does not currently provide."><meta property="og:title" content="Using a Third Party FAB with CoordinatorLayout"><meta property="og:description" content="Before the Design Support Library was announced at Google I/O last month, I had numerous third party libraries in my projects for various elements of Material Design. I&rsquo;ve enjoyed replacing the nav drawer, tabs, and parallax scrolling libraries with their support library counterparts. However, on one of my projects, we needed an expanding floating action button (FAB) similar to the one in Inbox, which the support library does not currently provide."><meta property="og:type" content="article"><meta property="og:url" content="https://andydyer.org/blog/2015/06/28/using-a-third-party-fab-with-coordinatorlayout/"><meta property="article:published_time" content="2015-06-28T00:00:00+00:00"><meta property="article:modified_time" content="2015-06-28T00:00:00+00:00"><link rel=stylesheet href=https://andydyer.org/scss/hyde-hyde.8d4a958e8a5a3e3358bc9061aef41d5fb922f553dd6da59906472e8aaa5f4a48.css integrity="sha256-jUqVjopaPjNYvJBhrvQdX7ki9VPdbaWZBkcuiqpfSkg="><link rel=stylesheet href=https://andydyer.org/scss/print.2744dcbf8a0b2e74f8a50e4b34e5f441be7cf93cc7de27029121c6a09f9e77bc.css integrity="sha256-J0Tcv4oLLnT4pQ5LNOX0Qb58+TzH3icCkSHGoJ+ed7w=" media=print><!--[if lt IE 9]><script src=https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js></script><script src=https://oss.maxcdn.com/respond/1.4.2/respond.min.js></script><![endif]--><link rel=apple-touch-icon-precomposed sizes=144x144 href=https://andydyer.org/apple-touch-icon-144-precomposed.png><link rel="shortcut icon" href=https://andydyer.org/favicon.png></head><body class=theme-base-0g><div class=sidebar><div class=container><div class=sidebar-about><div class=author-image><a href=https://andydyer.org/><img src="https://www.gravatar.com/avatar/e0ac1256093c733a5d5a26085b90966f?s=240&d=mp" class="img--circle img--headshot element--center" alt=gravatar></a></div><span class=site__title><a href=https://andydyer.org/>Andy Dyer</a></span><p class=site__description>Senior Android Engineer <a href=https://twitter.com/zalandotech>@ZalandoTech</a>, editor <a href=https://twitter.com/proandroiddev>@ProAndroidDev</a>, occasional conference speaker.</p></div><div class=collapsible-menu><input type=checkbox id=menuToggle>
<label for=menuToggle>Andy Dyer</label><div class=menu-content><div><ul class=sidebar-nav><li><a href=https://andydyer.org/categories/android><span>Android</span></a></li><li><a href=https://andydyer.org/categories/speaking><span>Speaking</span></a></li><li><a href=https://andydyer.org/blog/2009/04/19/bands-ive-seen-live><span>Bands I've Seen Live</span></a></li></ul></div><section class=social><a href=https://twitter.com/dammitandy rel=me><i class="fab fa-twitter fa-lg" aria-hidden=true></i></a><a href=https://github.com/abdyer rel=me><i class="fab fa-github fa-lg" aria-hidden=true></i></a><a href=https://linkedin.com/in/abdyer rel=me><i class="fab fa-linkedin fa-lg" aria-hidden=true></i></a></section></div></div></div></div><div class="content container"><article><header><h1>Using a Third Party FAB with CoordinatorLayout</h1><div class=post__meta><i class="fas fa-calendar-alt"></i>Jun 28, 2015
in
<a class="badge badge-category" href=https://andydyer.org/categories/android>ANDROID</a>
•
<a class="badge badge-category" href=https://andydyer.org/categories/apps>APPS</a>
•
<a class="badge badge-category" href=https://andydyer.org/categories/material-design>MATERIAL DESIGN</a><br><i class="fas fa-clock"></i>3 min read</div></header><div class=post><p>Before the Design Support Library was announced at Google I/O last month, I had numerous third party libraries in my projects for various elements of Material Design. I&rsquo;ve enjoyed replacing the nav drawer, tabs, and parallax scrolling libraries with their support library counterparts. However, on one of my projects, we needed an expanding floating action button (FAB) similar to the one in <a href="https://play.google.com/store/apps/details?id=com.google.android.apps.inbox">Inbox</a>, which the support library does not currently provide.</p><p>I chose <a href=https://github.com/futuresimple/android-floating-action-button>this</a> FAB library since it includes a cool little animation from the plus sign to the &ldquo;X&rdquo; when expanding the menu. I foolishly thought I could just drop this into a CoordinatorLayout in place of the support library&rsquo;s FAB. If you&rsquo;ve checked out Chris Banes&rsquo; excellent <a href=https://github.com/chrisbanes/cheesesquare>Cheesesquare</a> sample, you might have noticed the <code>app:layout_anchor</code> and <code>app:layout_anchorGravity</code> attributes defined on the <code>FloatingActionButton</code> element:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=color:#f92672>&lt;android.support.design.widget.FloatingActionButton</span>
        <span style=color:#a6e22e>android:layout_height=</span><span style=color:#e6db74>&#34;wrap_content&#34;</span>
        <span style=color:#a6e22e>android:layout_width=</span><span style=color:#e6db74>&#34;wrap_content&#34;</span>
        <span style=color:#a6e22e>app:layout_anchor=</span><span style=color:#e6db74>&#34;@id/appbar&#34;</span>
        <span style=color:#a6e22e>app:layout_anchorGravity=</span><span style=color:#e6db74>&#34;bottom|right|end&#34;</span>
        <span style=color:#a6e22e>android:src=</span><span style=color:#e6db74>&#34;@drawable/ic_discuss&#34;</span>
        <span style=color:#a6e22e>android:layout_margin=</span><span style=color:#e6db74>&#34;@dimen/fab_margin&#34;</span>
        <span style=color:#a6e22e>android:clickable=</span><span style=color:#e6db74>&#34;true&#34;</span><span style=color:#f92672>/&gt;</span>
</code></pre></div><p>These two attributes are what tells the enclosing <code>CoordinatorLayout</code> how to position the button and how it should behave when scrolling. To investigate how they are used, I used the good ol&rsquo; <code>⌘+B</code> shortcut to go to the <code>FloatingActionButton</code>'s class definition. While the support library is not open source, I was still able to view the decompiled source.</p><p>The first thing I noticed is the <code>@DefaultBehavior(FloatingActionButton.Behavior.class)</code> annotation at the top of the class. The <code>FloatingActionButton.Behavior</code> child class provides the <code>Behavior</code> implementation used by <code>CoordinatorLayout</code>. I copied and pasted this inner class into my own subclass of the third party library&rsquo;s <code>FloatingActionsMenu</code> class, updated the generic type, and started resolving the compile errors. It didn&rsquo;t take me long to realize that several package private classes and methods were being called in this code. There are two ways to solve this. One is to copy the decompiled source of these classes into my project, but there is still the <code>AppBarLayout</code>'s package private <code>getMinimumHeightForVisibleOverlappingContent()</code> method to deal with. A simpler, yet slightly hackish way to handle this is to just define our class in a <code>android.support.design.widget</code> package.</p><p>The last issue specific to this library is that its measured height includes its children, so the FAB is not correctly positioned on the edge of the image and content views. After a bit of experimentation, I solved this by overriding <code>onMeasure()</code>:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=color:#a6e22e>@Override</span>
<span style=color:#66d9ef>protected</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>onMeasure</span><span style=color:#f92672>(</span><span style=color:#66d9ef>int</span> widthMeasureSpec<span style=color:#f92672>,</span> <span style=color:#66d9ef>int</span> heightMeasureSpec<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
    <span style=color:#66d9ef>super</span><span style=color:#f92672>.</span><span style=color:#a6e22e>onMeasure</span><span style=color:#f92672>(</span>widthMeasureSpec<span style=color:#f92672>,</span> heightMeasureSpec<span style=color:#f92672>);</span>
    <span style=color:#75715e>// measured height includes child views, so translate Y to align FAB on view edges
</span><span style=color:#75715e></span>    <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>getTranslationY<span style=color:#f92672>()</span> <span style=color:#f92672>==</span> 0<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
        View fab <span style=color:#f92672>=</span> getChildAt<span style=color:#f92672>(</span>getChildCount<span style=color:#f92672>()</span> <span style=color:#f92672>-</span> 1<span style=color:#f92672>);</span> <span style=color:#75715e>// last child is the FAB
</span><span style=color:#75715e></span>        <span style=color:#66d9ef>int</span> shadowRadius <span style=color:#f92672>=</span> getResources<span style=color:#f92672>().</span><span style=color:#a6e22e>getDimensionPixelSize</span><span style=color:#f92672>(</span>R<span style=color:#f92672>.</span><span style=color:#a6e22e>dimen</span><span style=color:#f92672>.</span><span style=color:#a6e22e>fab_shadow_radius</span><span style=color:#f92672>);</span>
        <span style=color:#66d9ef>int</span> offset <span style=color:#f92672>=</span> <span style=color:#f92672>(</span>getMeasuredHeight<span style=color:#f92672>()</span> <span style=color:#f92672>-</span> fab<span style=color:#f92672>.</span><span style=color:#a6e22e>getMeasuredHeight</span><span style=color:#f92672>()</span> <span style=color:#f92672>+</span> shadowRadius<span style=color:#f92672>)</span> <span style=color:#f92672>/</span> 2<span style=color:#f92672>;</span>
        ViewCompat<span style=color:#f92672>.</span><span style=color:#a6e22e>setTranslationY</span><span style=color:#f92672>(</span><span style=color:#66d9ef>this</span><span style=color:#f92672>,</span> offset<span style=color:#f92672>);</span>
    <span style=color:#f92672>}</span>
<span style=color:#f92672>}</span>
</code></pre></div><p>The <a href=https://github.com/abdyer/cheesesquare/blob/master/app/src/main/java/android/support/design/widget/SupportFloatingActionsMenu.java>source</a> for <code>SupportFloatingActionsMenu</code> is on GitHub in <a href=https://github.com/abdyer/cheesesquare>my Cheesesquare fork</a>. Hopefully we&rsquo;ll see first class support for integrating alternate FAB implementations more cleanly with the support library soon.</p><p>Here&rsquo;s a screen shot of the end result:</p><br><p><img src=https://andydyer.org/images/cheesesquare_fab_menu.png alt="Cheesesquare FAB menu" style=width:405px;margin-left:auto;margin-right:auto;display:block></p><br></div><div class="navigation navigation-single"><a href=https://andydyer.org/blog/2015/06/09/the-time-i-interviewed-at-google/ class=navigation-prev><i aria-hidden=true class="fa fa-chevron-left"></i><span class=navigation-tittle>The Time I Interviewed at Google</span></a>
<a href=https://andydyer.org/blog/2016/01/02/top-10-albums-of-2015/ class=navigation-next><span class=navigation-tittle>Top 10 Albums of 2015</span>
<i aria-hidden=true class="fa fa-chevron-right"></i></a></div></article></div><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-48421946-1','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><script defer src=https://use.fontawesome.com/releases/v5.11.2/js/all.js integrity=sha384-b3ua1l97aVGAPEIe48b4TC60WUQbQaGi2jqAWM90y0OZXZeyaTCWtBTKtjW2GXG1 crossorigin=anonymous></script></body></html>